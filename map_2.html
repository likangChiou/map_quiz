<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸–ç•Œåœ°åœ–è¨˜æ†¶éŠæˆ²</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        /* æ¨£å¼ä¿æŒä¸è®Š */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
        }
        
        .start-screen, .game-screen {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
        }
        
        .start-screen h1 {
            font-size: 2.5em;
            color: #333;
            margin-bottom: 20px;
        }
        
        .start-screen p {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 20px; 
        }

        .input-group {
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            font-size: 1.1em;
            color: #444;
        }

        .input-group input {
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 8px;
            width: 100px;
            text-align: center;
            font-size: 1.1em;
        }
        
        .score-display {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            font-size: 1.5em;
        }
        
        .score-display .score {
            color: #667eea;
            font-weight: bold;
            font-size: 2em;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .game-screen {
            padding: 20px;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .game-info {
            display: flex;
            gap: 30px;
            font-size: 1.1em;
        }
        
        .game-info span {
            color: #666;
        }
        
        .game-info strong {
            color: #667eea;
            margin-left: 5px;
        }
        
        #map {
            width: 100%;
            height: 500px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .question-text {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 20px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 10px;
            border-left: 5px solid #ffc107;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .option-btn {
            padding: 20px;
            font-size: 1.1em;
            border: 3px solid #e0e0e0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            text-align: center;
        }
        
        .option-btn:hover:not(:disabled) {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateY(-2px);
        }
        
        .option-btn.correct {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        
        .option-btn.wrong {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .next-btn {
            background: #28a745;
            margin-top: 10px;
        }
        
        .next-btn:hover {
            background: #218838;
        }
        
        .reset-btn {
            background: #6c757d;
            padding: 10px 20px;
            font-size: 0.9em;
        }
        
        .reset-btn:hover {
            background: #5a6268;
        }
        
        .hidden {
            display: none !important;
        }
        
        .leaflet-container {
            background: #aad3df;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .start-screen, .game-screen {
                padding: 20px;
            }
            
            .start-screen h1 {
                font-size: 1.8em;
            }
            
            #map {
                height: 350px;
            }
            
            .options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="startScreen" class="start-screen">
            <h1>ğŸŒ ä¸–ç•Œåœ°åœ–è¨˜æ†¶éŠæˆ²</h1>
            <p>æ¸¬è©¦ä½ å°ä¸–ç•Œå„åœ‹çš„èªè­˜ï¼</p>
            <p style="font-size: 1em; color: #888;">æ¶µè“‹æ‰€æœ‰ä¸»è¦åœ‹å®¶ã€å¾®å‹åœ‹å®¶å’Œçˆ­è­°åœ°å€</p>

            <div class="input-group">
                <label for="questionCount">éŠæˆ²é¡Œæ•¸ï¼š</label>
                <input type="number" id="questionCount" value="20" min="5" max="200">
            </div>

            <div id="finalScore" class="score-display hidden">
                <div>éŠæˆ²çµæŸï¼</div>
                <div class="score" id="finalScoreText"></div>
                <div id="accuracyText"></div>
            </div>
            <button class="btn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
            <div id="loadingMsg" class="loading hidden">è¼‰å…¥é«˜è§£æåº¦åœ°åœ–è³‡æ–™ä¸­... (ç´„ 14.5MBï¼Œå¯èƒ½éœ€æ•¸ç§’)</div>
        </div>
        
        <div id="gameScreen" class="game-screen hidden">
            <div class="game-header">
                <div class="game-info">
                    <div>
                        <span>é¡Œç›®:</span>
                        <strong id="questionNum">1 / 100</strong>
                    </div>
                    <div>
                        <span>ç­”å°:</span>
                        <strong id="scoreNum">0</strong>
                    </div>
                </div>
                <button class="btn reset-btn" onclick="resetGame()">é‡æ–°é–‹å§‹</button>
            </div>
            
            <div id="map"></div>
            
            <div class="question-text">
                è«‹é¸æ“‡åœ°åœ–ä¸Šç´…è‰²é«˜äº®é¡¯ç¤ºçš„åœ‹å®¶åç¨± â¬†ï¸
            </div>
            
            <div class="options" id="options"></div>
            
            <button id="nextBtn" class="btn next-btn hidden" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â†’</button>
        </div>
    </div>

    <script>
        // GeoJSON URL å·²ç¶“æ›¿æ›ç‚ºæ‚¨æ¸¬è©¦éçš„ã€åŒ…å«å°åœ‹çš„é«˜è§£æåº¦æ•¸æ“šæº
        const GEO_JSON_URL = 'https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson';

        // ä¿®æ­£å¾Œçš„åœ‹å®¶åˆ—è¡¨ï¼šåŒ…å«æ‰€æœ‰å¾®å‹åœ‹å®¶å’Œå³¶åœ‹ï¼Œä¸¦å·²ä¿®æ­£ GeoJSON åŒ¹é…åç¨±
        var countries = [
            // äºæ´²
            { name: 'ä¸­è¯äººæ°‘å…±å’Œåœ‹', nameEn: 'China', zoom: 4 },
            { name: 'å°ç£', nameEn: 'Taiwan', zoom: 7 }, // çˆ­è­°åœ°å€
            { name: 'æ—¥æœ¬', nameEn: 'Japan', zoom: 5 },
            { name: 'å°åº¦', nameEn: 'India', zoom: 5 },
            { name: 'æ³°åœ‹', nameEn: 'Thailand', zoom: 6 },
            { name: 'è¶Šå—', nameEn: 'Vietnam', zoom: 6 },
            { name: 'å—éŸ“', nameEn: 'South Korea', zoom: 7 },
            { name: 'å°å°¼', nameEn: 'Indonesia', zoom: 5 },
            { name: 'é¦¬ä¾†è¥¿äº', nameEn: 'Malaysia', zoom: 6 },
            { name: 'è²å¾‹è³“', nameEn: 'Philippines', zoom: 6 },
            { name: 'å·´åŸºæ–¯å¦', nameEn: 'Pakistan', zoom: 5 },
            { name: 'å­ŸåŠ æ‹‰', nameEn: 'Bangladesh', zoom: 7 },
            { name: 'å“ˆè–©å…‹', nameEn: 'Kazakhstan', zoom: 5 },
            { name: 'çƒèŒ²åˆ¥å…‹', nameEn: 'Uzbekistan', zoom: 6 },
            { name: 'åœŸåº«æ›¼', nameEn: 'Turkmenistan', zoom: 6 },
            { name: 'å¡”å‰å…‹', nameEn: 'Tajikistan', zoom: 7 },
            { name: 'å‰çˆ¾å‰æ–¯', nameEn: 'Kyrgyzstan', zoom: 7 },
            { name: 'é˜¿å¯Œæ±—', nameEn: 'Afghanistan', zoom: 6 },
            { name: 'å°¼æ³Šçˆ¾', nameEn: 'Nepal', zoom: 7 },
            { name: 'ä¸ä¸¹', nameEn: 'Bhutan', zoom: 8 },
            { name: 'æ–¯é‡Œè˜­å¡', nameEn: 'Sri Lanka', zoom: 7 },
            { name: 'ç·¬ç”¸', nameEn: 'Myanmar', zoom: 6 },
            { name: 'å¯®åœ‹', nameEn: 'Laos', zoom: 7 },
            { name: 'æŸ¬åŸ”å¯¨', nameEn: 'Cambodia', zoom: 7 },
            { name: 'æ–°åŠ å¡', nameEn: 'Singapore', zoom: 11 }, // æ–° GeoJSON æ‡‰å¯åŒ¹é…
            { name: 'æ±¶èŠ', nameEn: 'Brunei', zoom: 9 },
            { name: 'æ±å¸æ±¶', nameEn: 'East Timor', zoom: 9 },
            { name: 'è’™å¤', nameEn: 'Mongolia', zoom: 5 },
            { name: 'åŒ—éŸ“', nameEn: 'North Korea', zoom: 7 },
            { name: 'é¦¬çˆ¾åœ°å¤«', nameEn: 'Maldives', zoom: 9 }, // æ–° GeoJSON æ‡‰å¯åŒ¹é…
            { name: 'å¡å¸­çˆ¾', nameEn: 'Seychelles', zoom: 9 }, // æ–° GeoJSON æ‡‰å¯åŒ¹é…
            { name: 'å–¬æ²»äº', nameEn: 'Georgia', zoom: 7 },
            { name: 'äºç¾å°¼äº', nameEn: 'Armenia', zoom: 8 },
            { name: 'äºå¡æ‹œç„¶', nameEn: 'Azerbaijan', zoom: 7 },


            // ä¸­æ±
            { name: 'æ²™çƒåœ°é˜¿æ‹‰ä¼¯', nameEn: 'Saudi Arabia', zoom: 5 },
            { name: 'åœŸè€³å…¶', nameEn: 'Turkey', zoom: 6 },
            { name: 'ä¼Šæœ—', nameEn: 'Iran', zoom: 5 },
            { name: 'ä¼Šæ‹‰å…‹', nameEn: 'Iraq', zoom: 6 },
            { name: 'æ•˜åˆ©äº', nameEn: 'Syria', zoom: 7 },
            { name: 'ç´„æ—¦', nameEn: 'Jordan', zoom: 7 },
            { name: 'é»å·´å«©', nameEn: 'Lebanon', zoom: 8 },
            { name: 'ä»¥è‰²åˆ—', nameEn: 'Israel', zoom: 8 },
            { name: 'å·´å‹’æ–¯å¦', nameEn: 'Palestine', zoom: 9, altNames: ['West Bank', 'Gaza Strip'] }, 
            { name: 'è‘‰é–€', nameEn: 'Yemen', zoom: 6 },
            { name: 'é˜¿æ›¼', nameEn: 'Oman', zoom: 6 },
            { name: 'é˜¿æ‹‰ä¼¯è¯åˆå¤§å…¬åœ‹', nameEn: 'United Arab Emirates', zoom: 7 },
            { name: 'å¡é”', nameEn: 'Qatar', zoom: 8 },
            { name: 'ç§‘å¨ç‰¹', nameEn: 'Kuwait', zoom: 8 },
            { name: 'å·´æ—', nameEn: 'Bahrain', zoom: 9 }, // æ–° GeoJSON æ‡‰å¯åŒ¹é…

            // æ­æ´²
            { name: 'ä¿„ç¾…æ–¯', nameEn: 'Russia', zoom: 3 },
            { name: 'è‹±åœ‹', nameEn: 'United Kingdom', zoom: 6 },
            { name: 'æ³•åœ‹', nameEn: 'France', zoom: 6 },
            { name: 'å¾·åœ‹', nameEn: 'Germany', zoom: 6 },
            { name: 'ç¾©å¤§åˆ©', nameEn: 'Italy', zoom: 6 },
            { name: 'è¥¿ç­ç‰™', nameEn: 'Spain', zoom: 6 },
            { name: 'æ³¢è˜­', nameEn: 'Poland', zoom: 6 },
            { name: 'ç¾…é¦¬å°¼äº', nameEn: 'Romania', zoom: 6 },
            { name: 'è·è˜­', nameEn: 'Netherlands', zoom: 7 },
            { name: 'æ¯”åˆ©æ™‚', nameEn: 'Belgium', zoom: 8 },
            { name: 'å¸Œè‡˜', nameEn: 'Greece', zoom: 6 },
            { name: 'è‘¡è„ç‰™', nameEn: 'Portugal', zoom: 7 },
            { name: 'æ·å…‹', nameEn: 'Czech Republic', zoom: 7, altNames: ['Czechia'] }, // ä¿®æ­£ï¼šåŠ å…¥ 'Czechia' å‚™ç”¨å
            { name: 'åŒˆç‰™åˆ©', nameEn: 'Hungary', zoom: 7 },
            { name: 'ç‘å…¸', nameEn: 'Sweden', zoom: 5 },
            { name: 'å¥§åœ°åˆ©', nameEn: 'Austria', zoom: 7 },
            { name: 'ç™½ä¿„ç¾…æ–¯', nameEn: 'Belarus', zoom: 6 },
            { name: 'ä¿åŠ åˆ©äº', nameEn: 'Bulgaria', zoom: 7 },
            { name: 'å¡çˆ¾ç¶­äº', nameEn: 'Serbia', zoom: 7, altNames: ['Republic of Serbia'] },
            { name: 'ç‘å£«', nameEn: 'Switzerland', zoom: 8 },
            { name: 'ä¸¹éº¥', nameEn: 'Denmark', zoom: 7 },
            { name: 'æ–¯æ´›ä¼å…‹', nameEn: 'Slovakia', zoom: 7 },
            { name: 'èŠ¬è˜­', nameEn: 'Finland', zoom: 5 },
            { name: 'æŒªå¨', nameEn: 'Norway', zoom: 5 },
            { name: 'æ„›çˆ¾è˜­', nameEn: 'Ireland', zoom: 7 },
            { name: 'å…‹ç¾…åŸƒè¥¿äº', nameEn: 'Croatia', zoom: 7 },
            { name: 'æ³¢å£«å°¼äºèµ«å¡å“¥ç¶­ç´', nameEn: 'Bosnia and Herzegovina', zoom: 7 },
            { name: 'ç«‹é™¶å®›', nameEn: 'Lithuania', zoom: 7 },
            { name: 'æ–¯æ´›ç¶­å°¼äº', nameEn: 'Slovenia', zoom: 8 },
            { name: 'æ‹‰è„«ç¶­äº', nameEn: 'Latvia', zoom: 7 },
            { name: 'æ„›æ²™å°¼äº', nameEn: 'Estonia', zoom: 7 },
            { name: 'æ‘©çˆ¾å¤šç“¦', nameEn: 'Moldova', zoom: 7 },
            { name: 'é˜¿çˆ¾å·´å°¼äº', nameEn: 'Albania', zoom: 7 },
            { name: 'åŒ—é¦¬å…¶é “', nameEn: 'North Macedonia', zoom: 8, altNames: ['Macedonia'] },
            { name: 'è’™ç‰¹å…§å“¥ç¾…', nameEn: 'Montenegro', zoom: 8 },
            { name: 'å†°å³¶', nameEn: 'Iceland', zoom: 6 },
            { name: 'è³½æ™®å‹’æ–¯', nameEn: 'Cyprus', zoom: 8 },
            { name: 'çƒå…‹è˜­', nameEn: 'Ukraine', zoom: 6 },
            { name: 'ç§‘ç´¢æ²ƒ', nameEn: 'Kosovo', zoom: 8 }, // çˆ­è­°åœ°å€
            { name: 'é¦¬çˆ¾ä»–', nameEn: 'Malta', zoom: 9 }, // æ–° GeoJSON æ‡‰å¯åŒ¹é…
            { name: 'ç›§æ£®å ¡', nameEn: 'Luxembourg', zoom: 9 },
            { name: 'æ¢µè’‚å²¡', nameEn: 'Vatican', zoom: 12 }, // ä¿®æ­£ï¼šç”± 'Vatican City' æ”¹ç‚º 'Vatican'
            { name: 'å®‰é“çˆ¾', nameEn: 'Andorra', zoom: 9 }, // æ–° GeoJSON æ‡‰å¯åŒ¹é…
            { name: 'è–é¦¬åˆ©è«¾', nameEn: 'San Marino', zoom: 9 }, // æ–° GeoJSON æ‡‰å¯åŒ¹é…
            { name: 'æ‘©ç´å“¥', nameEn: 'Monaco', zoom: 10 }, // æ–° GeoJSON æ‡‰å¯åŒ¹é…

            // éæ´²
            { name: 'å—é', nameEn: 'South Africa', zoom: 5 },
            { name: 'åŸƒåŠ', nameEn: 'Egypt', zoom: 6 },
            { name: 'å¥ˆåŠåˆ©äº', nameEn: 'Nigeria', zoom: 6 },
            { name: 'è¡£ç´¢æ¯”äº', nameEn: 'Ethiopia', zoom: 6 },
            { name: 'è‚¯äº', nameEn: 'Kenya', zoom: 6 },
            { name: 'å¦å°šå°¼äº', nameEn: 'United Republic of Tanzania', zoom: 6, altNames: ['Tanzania'] }, 
            { name: 'çƒå¹²é”', nameEn: 'Uganda', zoom: 7 },
            { name: 'é˜¿çˆ¾åŠåˆ©äº', nameEn: 'Algeria', zoom: 5 },
            { name: 'è˜‡ä¸¹', nameEn: 'Sudan', zoom: 6 },
            { name: 'æ‘©æ´›å“¥', nameEn: 'Morocco', zoom: 6 },
            { name: 'å®‰å“¥æ‹‰', nameEn: 'Angola', zoom: 6 },
            { name: 'è¿¦ç´', nameEn: 'Ghana', zoom: 7 },
            { name: 'è«ä¸‰æ¯”å…‹', nameEn: 'Mozambique', zoom: 6 },
            { name: 'é¦¬é”åŠ æ–¯åŠ ', nameEn: 'Madagascar', zoom: 6 },
            { name: 'å–€éº¥éš†', nameEn: 'Cameroon', zoom: 6 },
            { name: 'è±¡ç‰™æµ·å²¸', nameEn: 'CÃ´te d\'Ivoire', zoom: 7, altNames: ['Ivory Coast'] }, 
            { name: 'å°¼æ—¥', nameEn: 'Niger', zoom: 6 },
            { name: 'å¸ƒå‰ç´æ³•ç´¢', nameEn: 'Burkina Faso', zoom: 7 },
            { name: 'é¦¬åˆ©', nameEn: 'Mali', zoom: 5 },
            { name: 'é¦¬æ‹‰å¨', nameEn: 'Malawi', zoom: 7 },
            { name: 'å°šæ¯”äº', nameEn: 'Zambia', zoom: 6 },
            { name: 'å¡å…§åŠ çˆ¾', nameEn: 'Senegal', zoom: 7 },
            { name: 'ç´¢é¦¬åˆ©äº', nameEn: 'Somalia', zoom: 6 },
            { name: 'æŸ¥å¾·', nameEn: 'Chad', zoom: 6 },
            { name: 'è¾›å·´å¨', nameEn: 'Zimbabwe', zoom: 7 },
            { name: 'ç›§å®‰é”', nameEn: 'Rwanda', zoom: 8 },
            { name: 'è²å—', nameEn: 'Benin', zoom: 7 },
            { name: 'çªå°¼è¥¿äº', nameEn: 'Tunisia', zoom: 6 },
            { name: 'è’²éš†åœ°', nameEn: 'Burundi', zoom: 8 },
            { name: 'å—è˜‡ä¸¹', nameEn: 'South Sudan', zoom: 6 },
            { name: 'å¤šå“¥', nameEn: 'Togo', zoom: 8 },
            { name: 'ç…å­å±±', nameEn: 'Sierra Leone', zoom: 7 },
            { name: 'åˆ©æ¯”äº', nameEn: 'Libya', zoom: 5 },
            { name: 'è³´æ¯”ç‘äº', nameEn: 'Liberia', zoom: 7 },
            { name: 'èŒ…åˆ©å¡”å°¼äº', nameEn: 'Mauritania', zoom: 6 },
            { name: 'ä¸­éå…±å’Œåœ‹', nameEn: 'Central African Republic', zoom: 6 },
            { name: 'ç´ç±³æ¯”äº', nameEn: 'Namibia', zoom: 6 },
            { name: 'æ³¢æœ­é‚£', nameEn: 'Botswana', zoom: 6 },
            { name: 'ç”˜æ¯”äº', nameEn: 'Gambia', zoom: 8 },
            { name: 'åŠ å½­', nameEn: 'Gabon', zoom: 7 },
            { name: 'å¹¾å…§äº', nameEn: 'Guinea', zoom: 7 },
            { name: 'èµ¤é“å¹¾å…§äº', nameEn: 'Equatorial Guinea', zoom: 8 },
            { name: 'è³´ç´¢æ‰˜', nameEn: 'Lesotho', zoom: 8 },
            { name: 'å‰å¸ƒåœ°', nameEn: 'Djibouti', zoom: 8 },
            { name: 'å¹¾å…§äºæ¯”ç´¢', nameEn: 'Guinea Bissau', zoom: 8, altNames: ['Guinea-Bissau'] }, 
            { name: 'å‰›æœ (é‡‘)', nameEn: 'Democratic Republic of the Congo', zoom: 5 }, 
            { name: 'å‰›æœ (å¸ƒ)', nameEn: 'Republic of the Congo', zoom: 6 }, 
            { name: 'å„åˆ©å‚äº', nameEn: 'Eritrea', zoom: 7 }, 
            { name: 'è¥¿æ’’å“ˆæ‹‰', nameEn: 'Western Sahara', zoom: 7 }, // çˆ­è­°åœ°å€
            { name: 'ç¶­å¾·è§’', nameEn: 'Cabo Verde', zoom: 8 }, // ä¿®æ­£ï¼šç”± 'Cape Verde' æ”¹ç‚º 'Cabo Verde'
            { name: 'è–å¤šç¾æ™®æ—è¥¿æ¯”', nameEn: 'SÃ£o TomÃ© and Principe', zoom: 8 }, // ä¿®æ­£ï¼šç”± 'SÃ£o TomÃ© and PrÃ­ncipe' æ”¹ç‚º 'SÃ£o TomÃ© and Principe'

            // åŒ—ç¾æ´² (å·²è£œé½Šé‡è¦åŠ å‹’æ¯”æµ·åœ‹å®¶)
            { name: 'ç¾åœ‹', nameEn: 'United States of America', zoom: 4 },
            { name: 'åŠ æ‹¿å¤§', nameEn: 'Canada', zoom: 4 },
            { name: 'å¢¨è¥¿å“¥', nameEn: 'Mexico', zoom: 5 },
            { name: 'å¤å·´', nameEn: 'Cuba', zoom: 6 },
            { name: 'æµ·åœ°', nameEn: 'Haiti', zoom: 8 },
            { name: 'å¤šæ˜å°¼åŠ ', nameEn: 'Dominican Republic', zoom: 8 },
            { name: 'ç‰™è²·åŠ ', nameEn: 'Jamaica', zoom: 8 },
            { name: 'å·´æ‹¿é¦¬', nameEn: 'Panama', zoom: 8 },
            { name: 'å“¥æ–¯å¤§é»åŠ ', nameEn: 'Costa Rica', zoom: 8 },
            { name: 'å°¼åŠ æ‹‰ç“œ', nameEn: 'Nicaragua', zoom: 7 },
            { name: 'å®éƒ½æ‹‰æ–¯', nameEn: 'Honduras', zoom: 7 },
            { name: 'è–©çˆ¾ç“¦å¤š', nameEn: 'El Salvador', zoom: 8 },
            { name: 'ç“œåœ°é¦¬æ‹‰', nameEn: 'Guatemala', zoom: 7 },
            { name: 'è²é‡Œæ–¯', nameEn: 'Belize', zoom: 8 },
            { name: 'å·´å“ˆé¦¬', nameEn: 'The Bahamas', zoom: 8 }, // ä¿®æ­£ï¼šç”± 'Bahamas' æ”¹ç‚º 'The Bahamas'
            { name: 'è–å…‹é‡Œæ–¯å¤šç¦åŠå°¼ç¶­æ–¯', nameEn: 'Saint Kitts and Nevis', zoom: 9 },
            { name: 'å®‰åœ°å¡åŠå·´å¸ƒé”', nameEn: 'Antigua and Barbuda', zoom: 9 },
            { name: 'å¤šç±³å°¼å…‹', nameEn: 'Dominica', zoom: 9 },
            { name: 'è–éœ²è¥¿äº', nameEn: 'Saint Lucia', zoom: 9 },
            { name: 'è–æ–‡æ£®åŠæ ¼ç‘é‚£ä¸', nameEn: 'Saint Vincent and the Grenadines', zoom: 9 },
            { name: 'æ ¼ç‘é‚£é”', nameEn: 'Grenada', zoom: 9 },
            { name: 'å·´è²å¤š', nameEn: 'Barbados', zoom: 9 },
            { name: 'åƒé‡Œé”åŠæ‰˜å·´å“¥', nameEn: 'Trinidad and Tobago', zoom: 8 },


            // å—ç¾æ´²
            { name: 'å·´è¥¿', nameEn: 'Brazil', zoom: 4 },
            { name: 'é˜¿æ ¹å»·', nameEn: 'Argentina', zoom: 5 },
            { name: 'å“¥å€«æ¯”äº', nameEn: 'Colombia', zoom: 5 },
            { name: 'ç§˜é­¯', nameEn: 'Peru', zoom: 5 },
            { name: 'å§”å…§ç‘æ‹‰', nameEn: 'Venezuela', zoom: 6 },
            { name: 'æ™ºåˆ©', nameEn: 'Chile', zoom: 4 },
            { name: 'å„ç“œå¤š', nameEn: 'Ecuador', zoom: 7 },
            { name: 'ç»åˆ©ç¶­äº', nameEn: 'Bolivia', zoom: 5 },
            { name: 'å·´æ‹‰åœ­', nameEn: 'Paraguay', zoom: 6 },
            { name: 'çƒæ‹‰åœ­', nameEn: 'Uruguay', zoom: 7 },
            { name: 'è“‹äºé‚£', nameEn: 'Guyana', zoom: 7 },
            { name: 'è˜‡åˆ©å—', nameEn: 'Suriname', zoom: 7 },

            // å¤§æ´‹æ´²
            { name: 'æ¾³æ´²', nameEn: 'Australia', zoom: 4 },
            { name: 'ç´è¥¿è˜­', nameEn: 'New Zealand', zoom: 6 },
            { name: 'å·´å¸ƒäºç´å¹¾å…§äº', nameEn: 'Papua New Guinea', zoom: 6 },
            { name: 'æ–æ¿Ÿ', nameEn: 'Fiji', zoom: 7 },
            { name: 'ç´¢ç¾…é–€ç¾¤å³¶', nameEn: 'Solomon Islands', zoom: 7 },
            { name: 'è¬é‚£æœ', nameEn: 'Vanuatu', zoom: 7 },
            { name: 'è–©æ‘©äº', nameEn: 'Samoa', zoom: 8 }, // æ–° GeoJSON æ‡‰å¯åŒ¹é…
            { name: 'æ±åŠ ', nameEn: 'Tonga', zoom: 8 }, // æ–° GeoJSON æ‡‰å¯åŒ¹é…
            { name: 'å¯†å…‹ç¾…å°¼è¥¿äº', nameEn: 'Federated States of Micronesia', zoom: 7 }, // æ–° GeoJSON æ‡‰å¯åŒ¹é…
            { name: 'å¸›ç‰', nameEn: 'Palau', zoom: 9 }, // æ–° GeoJSON æ‡‰å¯åŒ¹é…
            { name: 'é¦¬ç´¹çˆ¾ç¾¤å³¶', nameEn: 'Marshall Islands', zoom: 8 }, // æ–° GeoJSON æ‡‰å¯åŒ¹é…
            { name: 'å‰é‡Œå·´æ–¯', nameEn: 'Kiribati', zoom: 7 }, // æ–° GeoJSON æ‡‰å¯åŒ¹é…
            { name: 'åç“¦é­¯', nameEn: 'Tuvalu', zoom: 9 } // æ–° GeoJSON æ‡‰å¯åŒ¹é…
        ];

        var map;
        var geoJsonLayer;
        var highlightLayer;
        var allCountriesData;
        var shuffledCountries = [];
        var currentQuestion = 0;
        var score = 0;
        var answered = false;
        var totalQuestions = 0;

        function shuffle(array) {
            var newArray = array.slice();
            for (var i = newArray.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = newArray[i];
                newArray[i] = newArray[j];
                newArray[j] = temp;
            }
            return newArray;
        }

        // æ ¸å¿ƒï¼šä¿®æ­£ GeoJSON æ•¸æ“šæŸ¥æ‰¾é‚è¼¯ (é‡å°æ–°çš„ GeoJSON çµæ§‹)
        function findCountryFeature(countryData) {
            
            // æ–° GeoJSON ä¾†æºå¯èƒ½ä½¿ç”¨çš„åç¨±å­—æ®µï¼šnameã€adminã€ADM0_A3_IS (ISOä»£ç¢¼)
            const nameFields = ['name', 'admin', 'ADM0_A3_IS']; 
            
            // 1. å˜—è©¦ä½¿ç”¨ä¸»è¦çš„è‹±æ–‡åç¨±åŒ¹é…
            let foundFeature = allCountriesData.features.find(function(feature) {
                var featureName = '';
                // ä¾åºæª¢æŸ¥å¯èƒ½çš„åç¨±æ¬„ä½
                for (const field of nameFields) {
                    if (feature.properties[field]) {
                        featureName = feature.properties[field];
                        break;
                    }
                }
                // åŒ¹é…ä¸»è¦è‹±æ–‡åç¨±
                return featureName.trim() === countryData.nameEn.trim();
            });

            // 2. å¦‚æœæ‰¾ä¸åˆ°ï¼Œæª¢æŸ¥æ˜¯å¦æœ‰å‚™ç”¨åç¨± (altNames)
            if (!foundFeature && countryData.altNames && countryData.altNames.length > 0) {
                foundFeature = allCountriesData.features.find(function(feature) {
                    var featureName = '';
                    for (const field of nameFields) {
                        if (feature.properties[field]) {
                            featureName = feature.properties[field];
                            break;
                        }
                    }
                    // åŒ¹é…å‚™ç”¨åç¨± (ç”¨æ–¼æ·å…‹ 'Czechia')
                    return countryData.altNames.some(altName => featureName.trim() === altName.trim());
                });
            }
            
            // 3. é‡å°å·´å‹’æ–¯å¦çš„ç‰¹æ®Šæª¢æŸ¥
            if (!foundFeature && countryData.nameEn === 'Palestine') {
                 foundFeature = allCountriesData.features.find(function(feature) {
                    var featureName = '';
                    for (const field of nameFields) {
                        if (feature.properties[field]) {
                            featureName = feature.properties[field];
                            break;
                        }
                    }
                    // æª¢æŸ¥æ˜¯å¦æ˜¯ West Bank æˆ– Gaza Strip
                    return featureName === 'West Bank' || featureName === 'Gaza Strip';
                });
            }
            
            return foundFeature;
        }


        function startGame() {
            var inputCount = parseInt(document.getElementById('questionCount').value, 10);
            
            // æª¢æŸ¥è¼¸å…¥æ˜¯å¦æœ‰æ•ˆ
            const maxCount = countries.length;
            if (isNaN(inputCount) || inputCount < 5 || inputCount > maxCount) {
                alert('è«‹è¼¸å…¥ 5 åˆ° ' + maxCount + ' ä¹‹é–“çš„æœ‰æ•ˆé¡Œæ•¸ï¼');
                document.getElementById('questionCount').value = 20;
                return;
            }

            totalQuestions = inputCount;
            document.getElementById('loadingMsg').classList.remove('hidden');
            
            // è¼‰å…¥ GeoJSON æ•¸æ“š (ä½¿ç”¨æ–°çš„é«˜è§£æåº¦ URL)
            fetch(GEO_JSON_URL)
                .then(function(response) { return response.json(); })
                .then(function(data) {
                    allCountriesData = data;
                    initGame();
                })
                .catch(function(error) {
                    console.error('Error loading map data:', error);
                    alert('ç„¡æ³•è¼‰å…¥é«˜è§£æåº¦åœ°åœ–è³‡æ–™ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šå¾Œé‡è©¦ (æª”æ¡ˆè¼ƒå¤§ï¼Œå¯èƒ½éœ€ç©©å®šç¶²è·¯)ã€‚');
                    document.getElementById('loadingMsg').classList.add('hidden');
                });
        }

        function initGame() {
            document.getElementById('loadingMsg').classList.add('hidden');
            
            // æ ¹æ“šä½¿ç”¨è€…è¼¸å…¥çš„é¡Œæ•¸éš¨æ©Ÿé¸å–åœ‹å®¶
            shuffledCountries = shuffle(countries).slice(0, totalQuestions);
            
            currentQuestion = 0;
            score = 0;
            
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            if (!map) {
                map = L.map('map', {
                    zoomControl: true,
                    attributionControl: false,
                    maxBounds: [[-90, -180], [90, 180]]
                }).setView([20, 0], 2);
                
                // åŸºç¤åœ‹å®¶è¼ªå»“åœ–å±¤
                geoJsonLayer = L.geoJSON(allCountriesData, {
                    style: function() {
                        return {
                            fillColor: '#95a5a6',
                            weight: 1,
                            opacity: 1,
                            color: '#34495e',
                            fillOpacity: 0.7
                        };
                    }
                }).addTo(map);
            } else {
                map.setView([20, 0], 2);
            }
            
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestion >= totalQuestions) {
                endGame();
                return;
            }

            answered = false;
            document.getElementById('nextBtn').classList.add('hidden');
            
            var correct = shuffledCountries[currentQuestion];
            
            if (highlightLayer) {
                map.removeLayer(highlightLayer);
            }
            
            // ä½¿ç”¨æ›´å¼·å¤§çš„æŸ¥æ‰¾å‡½æ•¸
            var countryFeature = findCountryFeature(correct);
            
            if (countryFeature) {
                highlightLayer = L.geoJSON(countryFeature, {
                    style: {
                        fillColor: '#e74c3c',
                        weight: 3,
                        opacity: 1,
                        color: '#c0392b',
                        fillOpacity: 0.8
                    }
                }).addTo(map);
                
                var bounds = highlightLayer.getBounds();
                map.fitBounds(bounds, {
                    padding: [50, 50],
                    maxZoom: correct.zoom,
                    animate: true,
                    duration: 1
                });
                console.log('æˆåŠŸé¡¯ç¤ºåœ‹å®¶:', correct.name);

            } else {
                // å¦‚æœ GeoJSON åç¨±ä¿®æ­£å¾Œä»æœ‰æ¥µå°‘æ•¸åœ‹å®¶æ‰¾ä¸åˆ°ï¼Œæˆ‘å€‘è·³éä¸¦è¨˜éŒ„
                console.error('ã€åš´é‡éŒ¯èª¤ã€‘æ–°çš„ GeoJSON æ‰¾ä¸åˆ°åœ‹å®¶:', correct.name, '(', correct.nameEn, ') - è·³éæ­¤é¡Œ');
                currentQuestion++;
                loadQuestion();
                return;
            }
            
            // ç”Ÿæˆé¸é …ï¼šå¾æ‰€æœ‰åœ‹å®¶ä¸­éš¨æ©Ÿé¸å– 3 å€‹éŒ¯èª¤ç­”æ¡ˆ
            var wrongOptions = shuffle(countries.filter(function(c) {
                return c.nameEn !== correct.nameEn;
            })).slice(0, 3);
            var allOptions = shuffle([correct].concat(wrongOptions));
            
            var optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';
            
            allOptions.forEach(function(option) {
                var btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option.name;
                btn.onclick = function() {
                    handleAnswer(option, correct);
                };
                optionsContainer.appendChild(btn);
            });
            
            document.getElementById('questionNum').textContent = (currentQuestion + 1) + ' / ' + totalQuestions;
            document.getElementById('scoreNum').textContent = score;
        }

        function handleAnswer(selected, correct) {
            if (answered) return;
            answered = true;
            
            var buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(function(btn) {
                btn.disabled = true;
                if (btn.textContent === correct.name) {
                    btn.classList.add('correct');
                } else if (btn.textContent === selected.name) {
                    btn.classList.add('wrong');
                }
            });
            
            if (selected.nameEn === correct.nameEn) {
                score++;
                document.getElementById('scoreNum').textContent = score;
            }
            
            document.getElementById('nextBtn').classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuestion++;
            loadQuestion();
        }

        function endGame() {
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
            
            var accuracy = Math.round((score / totalQuestions) * 100);
            document.getElementById('finalScore').classList.remove('hidden');
            document.getElementById('finalScoreText').textContent = score + ' / ' + totalQuestions;
            document.getElementById('accuracyText').textContent = 'æ­£ç¢ºç‡: ' + accuracy + '%';

            // é‡è¨­è¼¸å…¥æ¡†ç‚ºä¸Šæ¬¡çš„å€¼
            document.getElementById('questionCount').value = totalQuestions;
        }

        function resetGame() {
            if (confirm('ç¢ºå®šè¦é‡æ–°é–‹å§‹å—ï¼Ÿ')) {
                document.getElementById('gameScreen').classList.add('hidden');
                document.getElementById('startScreen').classList.remove('hidden');
                document.getElementById('finalScore').classList.add('hidden');
                if (highlightLayer) {
                    map.removeLayer(highlightLayer);
                }
                if (map) {
                    map.setView([20, 0], 2);
                }
            }
        }
    </script>
</body>
</html>